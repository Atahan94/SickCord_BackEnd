let getUser,getUserById;_ea7‍.x([["default",()=>_ea7‍.o]]);_ea7‍.w("../../../controller/user",[["getUser",["getUser"],function(v){getUser=v}],["getUserById",["getUserById"],function(v){getUserById=v}]]);

const getChat =  async (req, res) => {
    try {
      const user = await getUser(req.session.user.name);

      let chats = [...user.privateChats];

     /*  console.log("CHATS", chats); */
      
      const populatedChats = await Promise.all(chats.map(async (chat) => {
        const withUser = await getUserById(chat.with); // Kullanıcıyı ID ile al
        const base64Image = withUser.image.data.toString('base64');
        return {
          id: chat._id,
          with: {
            _id: withUser._id,
            name: withUser.name,
            mutualFriends: withUser.friends.filter(friendId => user.friends.includes(friendId)),
            mutualServers: withUser.servers.filter(serverId => user.servers.includes(serverId)),
            createdAt: withUser.createdAt,
          },
          image: `data:${withUser.image.contentType};base64,${base64Image}`,
          messages: [...chat.messages]
        };
      }));

      /* console.log("CHATS POPULATED", populatedChats); */
      
      
      res.status(200).json({ res: populatedChats});
      return Promise.resolve();
    } catch (error) {
      _ea7‍.g.console.log("error on the request", error)
      res.status(500).json({code: error});
    }
  };

  _ea7‍.d(getChat);